{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Abdul%20Mateen/OneDrive/Desktop/v0-instagram-video/app/api/proxy-download/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { url } = body\n\n    if (!url) {\n      return NextResponse.json({ error: \"URL is required\" }, { status: 400 })\n    }\n\n    // Validate that it's a valid video URL (more permissive)\n    const validDomains = [\"instagram\", \"cdninstagram\", \"fbcdn\", \"scontent\"]\n    const isValidUrl = validDomains.some(domain => url.includes(domain)) || url.startsWith(\"https://\")\n    \n    if (!isValidUrl) {\n      return NextResponse.json({ error: \"Invalid video URL\" }, { status: 400 })\n    }\n\n    // Fetch the video through our proxy with better headers\n    const response = await fetch(url, {\n      headers: {\n        \"User-Agent\": \"Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Mobile/15E148 Safari/604.1\",\n        \"Accept\": \"video/mp4,video/webm,video/*;q=0.9,*/*;q=0.8\",\n        \"Accept-Language\": \"en-US,en;q=0.9\",\n        \"Accept-Encoding\": \"identity\",\n        \"Referer\": \"https://www.instagram.com/\",\n        \"Origin\": \"https://www.instagram.com\",\n        \"Sec-Fetch-Dest\": \"video\",\n        \"Sec-Fetch-Mode\": \"cors\",\n        \"Sec-Fetch-Site\": \"cross-site\"\n      },\n      redirect: \"follow\"\n    })\n\n    if (!response.ok) {\n      console.error(`Failed to fetch video: ${response.status} ${response.statusText}`)\n      return NextResponse.json({ error: `Failed to fetch video: ${response.status}` }, { status: response.status })\n    }\n\n    const contentType = response.headers.get(\"content-type\") || \"video/mp4\"\n    const contentLength = response.headers.get(\"content-length\")\n\n    // Determine file extension based on content type\n    let extension = \"mp4\"\n    if (contentType.includes(\"webm\")) extension = \"webm\"\n    else if (contentType.includes(\"mov\")) extension = \"mov\"\n\n    // Stream the response\n    const headers = new Headers({\n      \"Content-Type\": contentType,\n      \"Content-Disposition\": `attachment; filename=\"instagram-video-${Date.now()}.${extension}\"`,\n      \"Cache-Control\": \"no-cache\",\n      \"Access-Control-Allow-Origin\": \"*\"\n    })\n\n    if (contentLength) {\n      headers.set(\"Content-Length\", contentLength)\n    }\n\n    return new NextResponse(response.body, {\n      status: 200,\n      headers,\n    })\n  } catch (error) {\n    console.error(\"[v0] Proxy download error:\", error)\n    return NextResponse.json({ \n      error: error instanceof Error ? error.message : \"Download failed\" \n    }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,GAAG,EAAE,GAAG;QAEhB,IAAI,CAAC,KAAK;YACR,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,yDAAyD;QACzD,MAAM,eAAe;YAAC;YAAa;YAAgB;YAAS;SAAW;QACvE,MAAM,aAAa,aAAa,IAAI,CAAC,CAAA,SAAU,IAAI,QAAQ,CAAC,YAAY,IAAI,UAAU,CAAC;QAEvF,IAAI,CAAC,YAAY;YACf,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,wDAAwD;QACxD,MAAM,WAAW,MAAM,MAAM,KAAK;YAChC,SAAS;gBACP,cAAc;gBACd,UAAU;gBACV,mBAAmB;gBACnB,mBAAmB;gBACnB,WAAW;gBACX,UAAU;gBACV,kBAAkB;gBAClB,kBAAkB;gBAClB,kBAAkB;YACpB;YACA,UAAU;QACZ;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,KAAK,CAAC,CAAC,uBAAuB,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,SAAS,UAAU,EAAE;YAChF,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,CAAC,uBAAuB,EAAE,SAAS,MAAM,EAAE;YAAC,GAAG;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAC7G;QAEA,MAAM,cAAc,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;QAC5D,MAAM,gBAAgB,SAAS,OAAO,CAAC,GAAG,CAAC;QAE3C,iDAAiD;QACjD,IAAI,YAAY;QAChB,IAAI,YAAY,QAAQ,CAAC,SAAS,YAAY;aACzC,IAAI,YAAY,QAAQ,CAAC,QAAQ,YAAY;QAElD,sBAAsB;QACtB,MAAM,UAAU,IAAI,QAAQ;YAC1B,gBAAgB;YAChB,uBAAuB,CAAC,sCAAsC,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,UAAU,CAAC,CAAC;YAC1F,iBAAiB;YACjB,+BAA+B;QACjC;QAEA,IAAI,eAAe;YACjB,QAAQ,GAAG,CAAC,kBAAkB;QAChC;QAEA,OAAO,IAAI,+QAAY,CAAC,SAAS,IAAI,EAAE;YACrC,QAAQ;YACR;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}